(this["webpackJsonpself-help-sheets"]=this["webpackJsonpself-help-sheets"]||[]).push([[0],{125:function(e,t,n){e.exports=n(163)},130:function(e,t,n){},131:function(e,t,n){},163:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(14),s=n.n(i),o=(n(130),n(15)),c=(n(131),n(132),n(211)),u=n(114),l=n(219),d=n(220),h=n(218),p=n(80),f=n(68),m=n(2),y=n.n(m),b=n(6),v=n(13),g=n(12),k=n(11),_=n(30),w={LOADING:"loading",SIGNED_IN:"signed_in",SIGNED_OUT:"signed_out",FAILED:"failed"};Object.freeze(w);var x=Object(_.a)("state"),j=Object(_.a)("stateListeners"),E=new(function(){function e(){var t=this;Object(v.a)(this,e),Object.defineProperty(this,x,{writable:!0,value:w.LOADING}),Object.defineProperty(this,j,{writable:!0,value:new Set}),function(e){console.assert("function"==typeof e),console.assert(0===e.length);var t=document.createElement("script");t.async=!0,t.src="https://apis.google.com/js/api.js",document.body.appendChild(t),t.onload=e,t.onerror=e}(Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.gapi){e.next=3;break}throw new Error("Failed loading GAPI");case 3:return e.next=5,new Promise((function(e){return window.gapi.load("client:auth2",e)}));case 5:return e.next=7,window.gapi.client.init({clientId:"479709565206-4ek8a502261s9sussiehpa5v146ns2ku.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],scope:"https://www.googleapis.com/auth/drive.appfolder"});case 7:if(O()){e.next=9;break}throw new Error("Failed registering client_id.");case 9:t._updateSignInState(),window.gapi.auth2.getAuthInstance().isSignedIn.listen(t._updateSignInState.bind(t)),e.next=19;break;case 13:return e.prev=13,e.t0=e.catch(0),console.log(e.t0),Object(k.a)(t,x)[x]=w.FAILED,t._notifyStateChanged(),e.abrupt("return");case 19:case"end":return e.stop()}}),e,null,[[0,13]])}))))}return Object(g.a)(e,[{key:"addStateListener",value:function(e){console.assert("function"==typeof e),console.assert(1===e.length),console.assert(!Object(k.a)(this,j)[j].has(e)),Object(k.a)(this,j)[j].add(e)}},{key:"removeStateListener",value:function(e){console.assert("function"==typeof e),console.assert(1===e.length),console.assert(Object(k.a)(this,j)[j].has(e)),Object(k.a)(this,j)[j].delete(e)}},{key:"waitForStateChange",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){t.addStateListener((function n(r){t.removeStateListener(n),e(r)}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"state",get:function(){return Object(k.a)(this,x)[x]}}]),Object(g.a)(e,[{key:"signIn",value:function(){console.assert(O()),window.mocha?window.gapi.auth2.getAuthInstance().signIn():window.gapi.auth2.getAuthInstance().signIn({prompt:"select_account"})}},{key:"signOut",value:function(){console.assert(O()),window.gapi.auth2.getAuthInstance().signOut()}},{key:"_notifyStateChanged",value:function(){var e,t=Object(f.a)(Object(k.a)(this,j)[j]);try{for(t.s();!(e=t.n()).done;){(0,e.value)(Object(k.a)(this,x)[x])}}catch(n){t.e(n)}finally{t.f()}}},{key:"_updateSignInState",value:function(){console.assert(Object(k.a)(this,x)[x]!==w.FAILED);var e=(console.assert(O()),window.gapi.auth2.getAuthInstance().isSignedIn.get()?w.SIGNED_IN:w.SIGNED_OUT);Object(k.a)(this,x)[x]!==e&&(Object(k.a)(this,x)[x]=e,this._notifyStateChanged())}}]),e}());function O(){return window.gapi&&window.gapi.auth2&&window.gapi.client}Object.seal(E);var C=n(22),S=n(32),D=n(20),A=n(19),I=function(e){e.active;return a.a.createElement("div",{style:{display:"flex",padding:10}},a.a.createElement("svg",{width:"18",height:"18",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("g",{fill:"#000",fillRule:"evenodd"},a.a.createElement("path",{d:"M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z",fill:"#EA4335"}),a.a.createElement("path",{d:"M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.84 2.92l2.84 2.2c1.7-1.57 2.68-3.88 2.68-6.62z",fill:"#4285F4"}),a.a.createElement("path",{d:"M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z",fill:"#FBBC05"}),a.a.createElement("path",{d:"M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.53-1.78.9-3.12.9-2.38 0-4.4-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z",fill:"#34A853"}),a.a.createElement("path",{fill:"none",d:"M0 0h18v18H0z"}))))},M=n(200),L=n(222),N=n(199),R=function(e){var t=e.children;return a.a.createElement("span",{style:{padding:10,paddingLeft:0,fontWeight:500}},t)},F={backgroundColor:"#fff",display:"inline-flex",alignItems:"center",color:"rgba(0, 0, 0, .54)",boxShadow:"0 2px 2px 0 rgba(0, 0, 0, .24), 0 0 1px 0 rgba(0, 0, 0, .24)",padding:0,borderRadius:2,border:"1px solid transparent",fontSize:14,fontWeight:"500",fontFamily:"Roboto, sans-serif",cursor:"pointer"},T={opacity:.6},K=Object(_.a)("setAuthState"),B=Object(_.a)("setButtonAnchor"),P=Object(_.a)("getButtonStyle"),z=Object(_.a)("onClick"),H=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(v.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={authState:e.props.gdriveAuthClient.state,prevAuthState:e.props.gdriveAuthClient.LOADING,buttonAnchor:null},Object.defineProperty(Object(S.a)(e),K,{writable:!0,value:function(t){e.setState((function(e){return Object(C.a)(Object(C.a)({},e),{},{prevAuthState:e.authState,authState:t})}))}}),Object.defineProperty(Object(S.a)(e),B,{writable:!0,value:function(t){e.setState((function(e){return Object(C.a)(Object(C.a)({},e),{},{buttonAnchor:t})}))}}),Object.defineProperty(Object(S.a)(e),P,{writable:!0,value:function(){return e.state.authState===w.FAILED||e.state.authState===w.LOADING?Object.assign({},F,T):F}}),Object.defineProperty(Object(S.a)(e),z,{writable:!0,value:function(){var t=Object(b.a)(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state.authState===w.SIGNED_IN?e.props.gdriveAuthClient.signOut():e.state.authState===w.SIGNED_OUT&&e.props.gdriveAuthClient.signIn();case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}),e}return Object(g.a)(n,[{key:"componentDidMount",value:function(){this.state.authState!==this.props.gdriveAuthClient.state&&Object(k.a)(this,K)[K](this.props.gdriveAuthClient.state),this.props.gdriveAuthClient.addStateListener(Object(k.a)(this,K)[K])}},{key:"componentWillUnmount",value:function(){this.props.gdriveAuthClient.removeStateListener(Object(k.a)(this,K)[K])}},{key:"render",value:function(){var e=this,t=function(){if(e.state.authState===w.FAILED)return a.a.createElement(L.a,{severity:"error"},"Failed connecting to google. Check your connection and try reloading the page.");if(e.state.authState===w.SIGNED_OUT){if(e.state.prevAuthState===w.SIGNED_IN)return a.a.createElement(L.a,{severity:"warning"},a.a.createElement(N.a,null,"Privacy note!"),"If other people have access to this browser ",a.a.createElement("br",null),"AND you don't want them to read your sheets: ",a.a.createElement("br",null),a.a.createElement("ol",null,a.a.createElement("li",null,"sign out globally: ",a.a.createElement("br",null),a.a.createElement("a",{href:"https://accounts.google.com/Logout"},"https://accounts.google.com/Logout")),a.a.createElement("li",null,"delete Google account password from the browser")));if(e.state.prevAuthState===w.LOADING)return a.a.createElement(L.a,{severity:"info"},"This site stores data in a hidden Google Drive folder. ",a.a.createElement("br",null),"Sign in to proceed.",a.a.createElement("br",null))}}();return a.a.createElement("button",{ref:function(t){return Object(k.a)(e,B)[B](t)},onClick:Object(k.a)(this,z)[z],style:Object(k.a)(this,P)[P](),type:"button"},a.a.createElement(I,{key:0,active:this.state.active}),a.a.createElement(R,{key:2},this.state.authState===w.SIGNED_IN?"Sign Out":"Sign In "),!!t&&!!this.state.buttonAnchor&&a.a.createElement(M.a,{key:1,style:{zIndex:1200},open:!0,anchorEl:this.state.buttonAnchor,placement:"bottom-end",disablePortal:!1,modifiers:{flip:{enabled:!1},preventOverflow:{enabled:!1},hide:{enabled:!1},offset:{offset:"0,5"}}},t))}}]),n}(a.a.PureComponent),U=n(201),V=Object(U.a)((function(e){return{root:{position:"absolute",top:"5%",left:"5%",width:"90%",height:"90%",backgroundColor:e.palette.background.paper,zIndex:1}}})),G=a.a.forwardRef((function(e,t){var n=V();return a.a.createElement("article",Object.assign({className:n.root},e,{ref:t}),a.a.createElement("h1",null,"User Guide"))})),q=n(46),W=n(37),J=n(116),Y=n(202),X=n(223),$=n(221),Q=n(203),Z=n(204),ee=n(165),te=n(198),ne=n(206),re=n(205),ae=n(109),ie=n.n(ae),se=Object(U.a)({container:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"}});function oe(e){var t=se();return a.a.createElement("div",{className:t.container},a.a.createElement(J.a,Object.assign({variant:"h4"},e),e.children))}var ce=function(){function e(t){if(Object(v.a)(this,e),"string"===typeof t&&(t=JSON.parse(t)),"boolean"!==typeof t.isEnabled||"string"!==typeof t.text)throw new Error("Wrong hint data "+JSON.stringify(t));this._isEnabled=t.isEnabled,this._text=t.text}return Object(g.a)(e,[{key:"setIsEnabled",value:function(t){return new e({isEnabled:t,text:this._text})}},{key:"setText",value:function(t){return new e({text:t,isEnabled:this._isEnabled})}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"text",get:function(){return this._text}}]),Object(g.a)(e,[{key:"stringify",value:function(){return JSON.stringify({isEnabled:this._isEnabled,text:this._text})}}]),e}(),ue=function(){function e(t){Object(v.a)(this,e);try{if("string"===typeof t&&(t=JSON.parse(t)),!Array.isArray(t.emojiList)||!t.emojiList.every((function(e){return"string"===typeof String.fromCodePoint(e.codePoint)})))throw new Error("Bad emoji list: "+JSON.stringify(t));this._emojiList=t.emojiList,this._leftHint=new ce(t.leftHint),this._rightHint=new ce(t.rightHint)}catch(n){t&&console.error("Settings format error:"+n.message),this._mutateToDefaults()}}return Object(g.a)(e,[{key:"setEmojiList",value:function(t){return new e({emojiList:t,leftHint:this._leftHint,rightHint:this._rightHint})}},{key:"setLeftHint",value:function(t){return new e({emojiList:this._emojiList,leftHint:t,rightHint:this._rightHint})}},{key:"setRightHint",value:function(t){return new e({emojiList:this._emojiList,leftHint:this._leftHint,rightHint:t})}},{key:"stringify",value:function(){return JSON.stringify({emojiList:this._emojiList,leftHint:this._leftHint.stringify(),rightHint:this._rightHint.stringify()})}},{key:"emojiList",get:function(){return this._emojiList}},{key:"leftHint",get:function(){return this._leftHint}},{key:"rightHint",get:function(){return this._rightHint}}]),Object(g.a)(e,[{key:"_mutateToDefaults",value:function(){this._leftHint=new ce({isEnabled:!0,text:"What happened?\nWhat were your immediate thoughts?"}),this._rightHint=new ce({isEnabled:!0,text:"Why is it bad?\nWhat would your therapist say?\nIs your view of the problem biased?"}),this._emojiList=[{codePoint:128078,text:"discontent"},{codePoint:128552,text:"fear"},{codePoint:128546,text:"sadness"},{codePoint:128557,text:"grief"},{codePoint:128561,text:"horror"},{codePoint:128534,text:"pain"},{codePoint:128545,text:"anger"},{codePoint:129314,text:"disgust"}]}}]),e}();function le(e,t,n){return de.apply(this,arguments)}function de(){return(de=Object(b.a)(y.a.mark((function e(t,n,r){var a,i,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){t.subscribe((function n(r){t.unsubscribe(n),e(r)}))}));case 2:return a=e.sent,i=!1,s=a.map((function(e){var t=e.emojiArrays.map((function(e){return he(e,n,r)}));return t.some((function(e){return e.someValuesAreDeleted}))&&(i=!0),e.setEmojiLeft(t[0].newArray).setEmojiRight(t[1].newArray)})),e.abrupt("return",{someValuesAreDeleted:i,newEntries:s});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e,t,n){for(var r=new Map,a=0;a<t.length;a++)r.set(t[a].codePoint,e[a]);for(var i=[],s=0;s<n.length;s++){var o=r.get(n[s].codePoint);i.push(null==o?0:o)}return{newArray:i,someValuesAreDeleted:t.some((function(e){return r.get(e.codePoint)>0&&null==n.find((function(t){return t.codePoint===e.codePoint}))}))}}var pe=a.a.memo(ie.a),fe=Object(U.a)((function(e){return{root:Object(W.a)({position:"absolute",top:"5%",left:"5%",width:"90%",height:"90%",backgroundColor:e.palette.background.default,zIndex:1e3,borderRadius:4,overflow:"auto",padding:10},e.breakpoints.up("sm"),{padding:30}),emojiIcon:{margin:"0px 5px 5px 0px ",fontSize:20,display:"flex",alignItems:"center",paddingLeft:10},hintContainer:{display:"flex",flexDirection:"column"},buttons:{marginTop:20,display:"flex",justifyContent:"space-between"},input:{backgroundColor:e.palette.background.paper}}}));function me(e){var t=fe();return a.a.createElement("div",{className:t.hintContainer},a.a.createElement(J.a,{variant:"h6"},e.label+":"),a.a.createElement(Y.a,{value:"end",label:"Enable popup",control:a.a.createElement(X.a,{checked:e.value.isEnabled,onChange:function(t){e.onChange(e.value.setIsEnabled(t.target.checked))}})}),a.a.createElement($.a,{value:e.value.text,onChange:function(t){return e.onChange(e.value.setText(t.target.value))},className:t.input,variant:"outlined",multiline:!0}))}function ye(e){var t=fe(),n=a.a.useState(E.state),r=Object(o.a)(n,2),i=r[0],s=r[1],c=a.a.useState(null),u=Object(o.a)(c,2),l=u[0],d=u[1];a.a.useEffect((function(){E.addStateListener(s)}),[]),a.a.useEffect((function(){var t=function(e,t){d((function(e){return null==e?t:e}))};return null!=e.model&&e.model.subscribe(t),function(){null!=e.model&&e.model.unsubscribe(t)}}),[e.model]);var h=a.a.useCallback((function(t,n){d((function(t){var r=n.emoji.codePointAt(0),a=n.names.length>0?n.names[n.names.length-1]:"";if(-1!==t.emojiList.findIndex((function(e){return e.codePoint===r})))return alert(a+" is already selected"),t;var i=Object(q.a)(t.emojiList);i.push({codePoint:r,text:a});var s=t.setEmojiList(i);e.model.onSettingsUpdate(s),d(s)}))}),[e.model]);if(i===w.SIGNED_OUT)return a.a.createElement(oe,null,"Sign in to proceed...");if(i===w.LOADING||null==l||null==e.model)return a.a.createElement(oe,null,"Loading...");var p=function(){var t=Object(b.a)(y.a.mark((function t(n){var r,a,i,s,o,c;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object(q.a)(l.emojiList),-1!==(a=r.findIndex((function(e){return e.codePoint===n})))){t.next=4;break}return t.abrupt("return");case 4:return r.splice(a,1),t.next=7,le(e.model,l.emojiList,r);case 7:if(i=t.sent,s=i.someValuesAreDeleted,o=i.newEntries,!s||window.confirm("This will delete some moods from some of the entries. Are you sure?")){t.next=12;break}return t.abrupt("return");case 12:o.forEach((function(t){e.model.onUpdate(t)})),c=l.setEmojiList(r),e.model.onSettingsUpdate(c),d(c);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=function(){var t=Object(b.a)(y.a.mark((function t(){var n,r,a,i,s;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new ue,t.next=3,le(e.model,l.emojiList,n.emojiList);case 3:r=t.sent,a=r.someValuesAreDeleted,i=r.newEntries,s=a?"This will delete some moods from some entries. Reset settings?":"Reset settings?",window.confirm(s)&&(i.forEach((function(t){e.model.onUpdate(t)})),e.model.onSettingsUpdate(n),d(n));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return a.a.createElement(Q.a,{container:!0,justify:"center",spacing:2},a.a.createElement(Q.a,{item:!0,xs:12},a.a.createElement(J.a,{variant:"h4",align:"center"},"Settings")),a.a.createElement(Q.a,{container:!0,item:!0,xs:12,spacing:2},a.a.createElement(Q.a,{item:!0,xs:12},a.a.createElement(J.a,{variant:"h5"},"Helper questions")),a.a.createElement(Q.a,{item:!0,xs:12,sm:6},a.a.createElement(me,{label:"Left",value:l.leftHint,onChange:function(t){var n=l.setLeftHint(t);e.model.onSettingsUpdate(n),d(n)}})),a.a.createElement(Q.a,{item:!0,xs:12,sm:6},a.a.createElement(me,{label:"Right",value:l.rightHint,onChange:function(t){var n=l.setRightHint(t);e.model.onSettingsUpdate(n),d(n)}})),a.a.createElement(Q.a,{item:!0,xs:12},a.a.createElement(Z.a,null))),a.a.createElement(Q.a,{container:!0,item:!0,xs:12,spacing:2},a.a.createElement(Q.a,{item:!0,xs:12},a.a.createElement(J.a,{variant:"h5"},"Moods")),a.a.createElement(Q.a,{container:!0,alignItems:"flex-start",justify:"flex-start",alignContent:"flex-start",item:!0,xs:12,sm:6},a.a.createElement(Q.a,{item:!0,xs:12},a.a.createElement(J.a,{variant:"h6"},"Active: ")),l.emojiList.map((function(e){return a.a.createElement(Q.a,{item:!0,key:e.codePoint},a.a.createElement(ee.a,{className:t.emojiIcon},a.a.createElement(J.a,null,String.fromCodePoint(e.codePoint)),a.a.createElement(te.a,{onClick:function(){return p(e.codePoint)}},a.a.createElement(re.a,null))))}))),a.a.createElement(Q.a,{item:!0,xs:12,sm:6},a.a.createElement(J.a,{variant:"h6"},"Add new:"),a.a.createElement(pe,{disableSkinTonePicker:!0,disableAutoFocus:!0,onEmojiClick:h})),a.a.createElement(Q.a,{item:!0,xs:12,className:t.buttons},a.a.createElement(ne.a,{color:"secondary",onClick:f},"Reset defaults"),a.a.createElement(ne.a,{color:"primary",onClick:e.onClose},"Close"))))}var be=a.a.forwardRef((function(e,t){var n=fe();return a.a.createElement("div",Object.assign({className:n.root},e,{ref:t}),a.a.createElement(ye,e))})),ve=n(212),ge=n(213),ke=n(224),_e=n(207),we=n(208),xe=n(209),je=n(210),Ee=n(225),Oe=Object(U.a)({buttonsContainer:{display:"flex",justifyContent:"flex-end",alignItems:"center"},titleContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}});function Ce(e){var t=a.a.useState(!1),n=Object(o.a)(t,2),r=n[0],i=n[1];a.a.useEffect((function(){e.model&&e.model.setIgnoreKeys(r)}),[r,e.model]);var s=function(){null!=e.model&&e.model.setIgnoreKeys(!1),i(!1)};return a.a.createElement(a.a.Fragment,null,a.a.createElement(te.a,Object.assign({},e,{onClick:function(){i(!0)}}),e.children[0]),a.a.createElement(ke.a,{open:r,onClose:s},a.a.cloneElement(e.children[1],{onClose:s})))}function Se(e){var t=Oe();return a.a.createElement(a.a.Fragment,null,a.a.createElement(_e.a,{appear:!1,in:e.shown},a.a.createElement(we.a,null)),a.a.createElement(xe.a,{appear:!1,direction:"down",in:e.shown},a.a.createElement(je.a,null,a.a.createElement(we.a,null,a.a.createElement(Q.a,{container:!0,justify:"space-between"},a.a.createElement(Ee.a,{xsDown:!0},a.a.createElement(Q.a,{item:!0,xs:4})),a.a.createElement(Q.a,{item:!0,xs:4,className:t.titleContainer},a.a.createElement(Ee.a,{xsDown:!0},a.a.createElement(J.a,{variant:"h6",align:"center"},"Self-help sheets"),a.a.createElement(J.a,{variant:"caption",align:"center"},"Document your inner dialog")),a.a.createElement(Ee.a,{smUp:!0},a.a.createElement(J.a,{variant:"h7",align:"center"},"Self-help sheets"))),a.a.createElement(Q.a,{item:!0,className:t.buttonsContainer,xs:8,sm:4},a.a.createElement(Ce,null,a.a.createElement(ve.a,null),a.a.createElement(G,null)),a.a.createElement(Ce,{model:e.model,edge:"start"},a.a.createElement(ge.a,null),a.a.createElement(be,{model:e.model})),a.a.createElement(H,{gdriveAuthClient:E})))))))}var De=n(25),Ae=n(226),Ie=n(215),Me=n(110),Le=n.n(Me),Ne=n(78),Re=n.n(Ne),Fe=n(56),Te=n(214),Ke=Object(U.a)((function(e){return{outer:{position:"relative"},popup:{position:"absolute",display:"flex",flexDirection:"column",justifyContent:"center",minWidth:140,zIndex:2,padding:10,background:e.palette.background.paper,border:"gray solid 2px",borderRadius:4}}})),Be=a.a.forwardRef((function(e,t){var n=Ke();return e.in&&a.a.createElement("div",{className:n.outer},a.a.createElement(Te.a,{in:e.in},a.a.createElement("div",{ref:t,className:n.popup},e.children)))})),Pe=Object(U.a)((function(e){return{container:{alignSelf:"flex-start",margin:2,cursor:"pointer",borderColor:function(e){return e?"gray":"#0000"},border:"solid 2px",borderRadius:4,position:"relative",backgroundColor:e.palette.background.paper},setupItem:{border:"2px solid",borderColor:function(e){return e?"darkgray":"#0000"},borderRadius:4,fontSize:20,display:"flex",alignItems:"center",justifyContent:"center"},icon:{cursor:"pointer",width:15,margin:0,padding:"4px 1px",height:"30px",border:"1px solid #0000",borderColor:function(e){return e?"gray":"#0000"}},emoji:{userSelect:"none",fontWeight:function(e){return 3===e?"bold":"unset"},opacity:function(e){return 3===e?1:2===e?.7:.3}}}}));function ze(e){var t=e.emoji,n=e.text,r=Object(De.a)(e,["emoji","text"]),i=Pe(r.value);return a.a.createElement("span",Object.assign({className:i.emoji,role:"img","aria-label":n},r),String.fromCodePoint(t))}function He(e){var t=e.selectedValue,n=e.value,r=Object(De.a)(e,["selectedValue","value"]),i=Pe(t===n),s=5*(3-n)+1;return a.a.createElement(Fe.a,Object.assign({className:i.icon,viewBox:"1 1 7 15"},r),a.a.createElement("rect",{y:s,width:"9",height:16-s,fill:n<=t?"red":"lightGray"}))}function Ue(e){var t=e.value,n=e.isActive,r=Object(De.a)(e,["value","isActive"]),i=Pe(n);return a.a.createElement("div",{className:i.setupItem},a.a.createElement(ze,Object.assign({},r,{value:3,onClick:function(){return r.onChange((t+1)%4)}})),a.a.createElement(He,{onClick:function(){return r.onChange(0)},selectedValue:t,value:0}),a.a.createElement(He,{onClick:function(){return r.onChange(1)},selectedValue:t,value:1}),a.a.createElement(He,{onClick:function(){return r.onChange(2)},selectedValue:t,value:2}),a.a.createElement(He,{onClick:function(){return r.onChange(3)},selectedValue:t,value:3}))}function Ve(e){var t=a.a.useState(!1),n=Object(o.a)(t,2),r=n[0],i=n[1],s=a.a.useState(-1),c=Object(o.a)(s,2),u=c[0],l=c[1],d=a.a.useRef(),h=Pe(r);if(0===e.emojiArray.length)return null;var p=e.emojiArray.filter((function(e){return e.value>0})),f=0;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{tabIndex:0,onFocus:function(t){e.onFocus(t),i(!0)},onBlur:function(t){d.current.contains(document.activeElement)||(i(!1),e.onBlur(t))},className:h.container,onKeyDown:function(t){if("ArrowLeft"===t.key){if(u<0&&l(u=0),u<e.emojiArray.length){var n=Object(q.a)(e.emojiArray);n[u].value--,n[u].value<0&&(n[u].value=3),e.onEmojiArrayChange(n)}}else if("ArrowRight"===t.key){if(u<0&&l(u=0),u<e.emojiArray.length){var r=Object(q.a)(e.emojiArray);r[u].value++,r[u].value>3&&(r[u].value=0),e.onEmojiArrayChange(r)}}else if("ArrowDown"===t.key)++u>=e.emojiArray.length&&(u=0),l(u);else if("ArrowUp"===t.key)--u<0&&(u=e.emojiArray.length-1),l(u);else{if("Escape"!==t.key&&"Enter"!==t.key)return;e.inputRef.current.focus()}t.preventDefault()}},p.length>0?p.map((function(e){return a.a.createElement(ze,{key:e.codePoint,emoji:e.codePoint,text:e.text,value:e.value})})):a.a.createElement(J.a,{variant:"caption",color:"textSecondary"},"add mood"),a.a.createElement(Be,{in:r,ref:d},a.a.createElement(J.a,{align:"center",variant:"body1"},e.text),e.emojiArray.map((function(t){return a.a.createElement(Ue,{key:t.codePoint,isActive:f++===u,emoji:t.codePoint,text:t.text,value:t.value,onChange:function(n){e.onEmojiArrayChange(e.emojiArray.map((function(e){return e.codePoint===t.codePoint?Object(C.a)(Object(C.a)({},e),{},{value:n}):e})))}})})),a.a.createElement(J.a,{align:"center",variant:"caption"},"Use arrow keys."))," "))}var Ge="loading",qe="hidden",We="deleted",Je="editLeft",Ye="editRight",Xe="none",$e=function(){function e(t,n,r){Object(v.a)(this,e),this._data=n,this._key=t,this._initiallyCollapsed=!1,this._focused=!1,this.lastChange=Xe,this._setDescriptionImpl(r)}return Object(g.a)(e,[{key:"isDataLoaded",value:function(){return this._data!==Ge&&this._data!==qe}},{key:"setDescription",value:function(e){var t=this.clone();return t._setDescriptionImpl(e),t}},{key:"setLeft",value:function(e){if(!this.isDataLoaded())return console.error("bad status"),this;var t=this.clone();return t._data=Object(C.a)(Object(C.a)({},this._data),{},{left:e}),t.lastChange=Je,t}},{key:"setRight",value:function(e){if(!this.isDataLoaded())return console.error("bad status"),this;var t=this.clone();return t._data=Object(C.a)(Object(C.a)({},this._data),{},{right:e}),t.lastChange=Ye,t}},{key:"setEmojiLeft",value:function(t){var n=this.setDescription(e._generateDescription(t,this._emojiArrays[1],this._creationTime));return n.lastChange=Je,n}},{key:"setEmojiRight",value:function(t){var n=this.setDescription(e._generateDescription(this._emojiArrays[0],t,this._creationTime));return n.lastChange=Ye,n}},{key:"setCreationTime",value:function(t){return this.setDescription(e._generateDescription(this._emojiArrays[0],this._emojiArrays[1],t))}},{key:"setInitiallyCollapsed",value:function(e){var t=this.clone();return t._initiallyCollapsed=e,t}},{key:"setFocused",value:function(e){var t=this.clone();return t._focused=e,t}},{key:"delete",value:function(){return new e(this._key,We,We)}},{key:"clear",value:function(){return new e(this._key,{left:"",right:""},"")}},{key:"show",value:function(){if(this._data!==qe)throw new Error("show() has been called for entry that is not hidden");return new e(this._key,Ge,this._description)}},{key:"clone",value:function(){var t=new e(this._key,this.data);return t._emojiArrays=this._emojiArrays,t._creationTime=this._creationTime,t._description=this._description,t._initiallyCollapsed=this._initiallyCollapsed,t._focused=this._focused,t.lastChange=this.lastChange,t}},{key:"data",get:function(){return this._data instanceof Object?Object(C.a)({},this._data):this._data}},{key:"key",get:function(){return this._key}},{key:"description",get:function(){return this.isDataLoaded()?this._description:""}},{key:"left",get:function(){return this.isDataLoaded()?this._data.left:""}},{key:"right",get:function(){return this.isDataLoaded()?this._data.right:""}},{key:"emojiArrays",get:function(){return this._emojiArrays}},{key:"creationTime",get:function(){return this._creationTime}},{key:"initiallyCollapsed",get:function(){return this._initiallyCollapsed}},{key:"focused",get:function(){return this._focused}}]),Object(g.a)(e,[{key:"_setDescriptionImpl",value:function(e){if(this._emojiArrays=[[],[]],this._creationTime=null,this._description=e,"string"===typeof e&&e.length>0&&e!==We){var t=e.split("-"),n=Object(o.a)(t,2),r=n[0],a=n[1];this._emojiArrays=r.split(":").map((function(e){return Array.from(e).map((function(e){return Number(e)}))})),2!==this._emojiArrays.length&&this._emojiArrays.push([]),this._creationTime=new Date(Number(a)),isNaN(this._creationTime.getTime())&&(this._creationTime=null)}}}],[{key:"_generateDescription",value:function(e,t,n){var r;return r=e.every((function(e){return 0===e}))&&t.every((function(e){return 0===e}))?"":e.join("")+":"+t.join(""),null!=n&&(r=r+"-"+n.getTime()),r}}]),e}(),Qe=function(e){return{border:"solid",borderRadius:4,backgroundColor:e.palette.background.paper,padding:function(e){return e.focused?4:5},borderWidth:function(e){return!0===e.focused?2:1},borderColor:function(t){return!0===t.focused?e.palette.primary.light:"gray"}}},Ze=Object(U.a)((function(e){return{inner:Object(W.a)({display:"flex",flex:1,flexDirection:"column",position:"relative"},e.breakpoints.up("sm"),Qe(e)),input:{padding:0,marginTop:function(e){return e.hasCreationTime?0:19},minHeight:function(e){return e.hasEmoji?76:104},alignItems:"flex-start"},outer:Object(W.a)({display:"flex",alignItems:"flex-start",flexDirection:"row"},e.breakpoints.down("xs"),Qe(e)),date:{border:"0px !important"},hint:{backgroundColor:e.palette.background.paper,whiteSpace:"pre-line"}}}));function et(e){var t=e.onFocus,n=e.emojiText,r=e.emojiArray,i=e.onDelete,s=e.creationTime,c=e.onEmojiArrayChange,u=e.onCollapseExited,l=e.collapsed,d=e.deleteXsDown,h=e.deleteSmUp,p=Object(De.a)(e,["onFocus","emojiText","emojiArray","onDelete","creationTime","onEmojiArrayChange","onCollapseExited","collapsed","deleteXsDown","deleteSmUp"]),f=a.a.useState(!1),m=Object(o.a)(f,2),y=m[0],b=m[1],v=a.a.useState(!1),g=Object(o.a)(v,2),k=g[0],_=g[1];a.a.useEffect((function(){y&&t(null,!0)}),[y,t]);var w=Ze({hasCreationTime:!!s,hasEmoji:r.length>0,focused:y||k}),x=a.a.useRef();return a.a.useEffect((function(){!l&&p.autoFocus&&x.current.focus()}),[l,p.autoFocus]),a.a.createElement(_e.a,{in:!l,onExited:u,onEntered:function(){p.autoFocus&&x.current.focus()}},a.a.createElement("div",{className:w.outer},a.a.createElement("div",{className:w.inner,onClick:function(){0===window.getSelection().toString().length&&x.current.focus()}},s&&a.a.createElement(J.a,{variant:"caption",color:"textSecondary",align:"center"},Re()(s).format("h:mm a")),a.a.createElement(Ae.a,Object.assign({className:w.input,fullWidth:!0,multiline:!0,placeholder:p.hint?p.hint.text:"",variant:"outlined",inputRef:x,onFocus:function(e){b(!0),t(e)},onBlur:function(e){b(!1)}},p)),a.a.createElement(Ve,{text:n,onEmojiArrayChange:c,emojiArray:r,inputRef:x,onFocus:function(e){t(e),_(!0)},onBlur:function(e){_(!1)}}),null!=p.hint&&p.hint.isEnabled&&p.value.length>0&&a.a.createElement(Be,{in:y},a.a.createElement(J.a,{className:w.hint,color:"textSecondary",padding:10},p.hint.text))),a.a.createElement(Ee.a,{xsDown:!d,smUp:!h},a.a.createElement(te.a,{"aria-label":"delete",size:"small",onClick:i},a.a.createElement(Le.a,{color:"action",fontSize:"small"})))))}var tt=a.a.forwardRef((function(e,t){var n=e.onFocus,r=e.onUpdate,i=(e.onRightChanged,e.entry),s=e.settings,c=Object(De.a)(e,["onFocus","onUpdate","onRightChanged","entry","settings"]),u=Ze(),l=!!i.text||i.initiallyCollapsed,d=a.a.useState(l),h=Object(o.a)(d,2),p=h[0],f=h[1];if(a.a.useEffect((function(){l&&f(!1)}),[l]),i.text)return a.a.createElement("tr",{ref:t,className:u.date},a.a.createElement("td",{colSpan:2},a.a.createElement(_e.a,{in:!p},a.a.createElement(J.a,{variant:"body2",align:"center",color:"textSecondary"},i.text))));console.assert(i instanceof $e),a.a.useEffect((function(){i.initiallyCollapsed&&r(i.setInitiallyCollapsed(!1),!0)}),[i,r]),a.a.useEffect((function(){i.data===qe&&r(i.show(),!0)}));var m=[],y=[];if(null!=s)for(var b=0;b<s.emojiList.length;b++)m.push(Object(C.a)({value:null==i.emojiArrays[0][b]?0:i.emojiArrays[0][b]},s.emojiList[b])),y.push(Object(C.a)({value:null==i.emojiArrays[1][b]?0:i.emojiArrays[1][b]},s.emojiList[b]));var v=function(e){r(e)},g=function(e,t){i.focused&&r(i.setFocused(!1),!0),t||n(e)};return a.a.createElement("tr",{ref:t},a.a.createElement("td",{key:"issueElement"},i.isDataLoaded()?a.a.createElement(et,Object.assign({autoFocus:i.focused&&i.lastChange!==Ye,color:"secondary",creationTime:i.creationTime,value:i.left,onChange:function(e){return v(i.setLeft(e.target.value))},onFocus:g,onDelete:function(){f(!0)},deleteXsDown:!0,collapsed:p,hint:null==s?null:s.leftHint,emojiText:"How do you feel now?",emojiArray:m,onEmojiArrayChange:function(e){return v(i.setEmojiLeft(e.map((function(e){return e.value}))))}},c)):a.a.createElement(Ie.a,{variant:"rect",height:135})),a.a.createElement("td",{key:"resolutionElement"},i.isDataLoaded()?a.a.createElement(et,Object.assign({autoFocus:i.focused&&i.lastChange===Ye,color:"primary",variant:"outlined",value:i.right,onChange:function(e){return v(i.setRight(e.target.value))},onFocus:g,deleteSmUp:!0,onDelete:function(){f(!0)},collapsed:p,onCollapseExited:function(e){return r(i.delete())},hint:null==s?null:s.rightHint,emojiText:"How do you feel after writing resolution?",emojiArray:y,onEmojiArrayChange:function(e){return v(i.setEmojiRight(e.map((function(e){return e.value}))))}},c)):a.a.createElement(Ie.a,{variant:"rect",height:135})))})),nt=n(111),rt=n.n(nt),at=n(45),it=n.n(at),st=n(7),ot=Object(_.a)("onHeightChanged"),ct=Object(_.a)("resizeObserver"),ut=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(v.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).ref=a.a.createRef(),Object.defineProperty(Object(S.a)(e),ot,{writable:!0,value:function(){e.ref.current&&e.props.onHeightChanged(e.props.entry,e.ref.current.offsetHeight)}}),Object.defineProperty(Object(S.a)(e),ct,{writable:!0,value:null}),e}return Object(g.a)(n,[{key:"componentDidMount",value:function(){this.ref.current&&(Object(k.a)(this,ct)[ct]=new ResizeObserver(Object(k.a)(this,ot)[ot]),Object(k.a)(this,ct)[ct].observe(this.ref.current))}},{key:"componentWillUnmount",value:function(){this.ref.current.contains(document.activeElement)&&this.props.scrollableContainerRef.current&&this.props.scrollableContainerRef.current.focus(),Object(k.a)(this,ct)[ct]&&(Object(k.a)(this,ct)[ct].disconnect(),Object(k.a)(this,ct)[ct]=null)}},{key:"render",value:function(){var e=this.props,t=(e.scrollableContainerRef,e.ItemComponent),n=(e.onHeightChanged,Object(De.a)(e,["scrollableContainerRef","ItemComponent","onHeightChanged"]));return a.a.createElement(t,Object.assign({ref:this.ref},n))}}]),n}(a.a.PureComponent);function lt(e){var t=e.entries,n=e.defaultHeight,r=void 0===n?150:n,i=e.scrollableContainerRef,s=e.ItemComponent,c=e.PlaceholderComponent,u=Object(De.a)(e,["entries","defaultHeight","scrollableContainerRef","ItemComponent","PlaceholderComponent"]),l=a.a.useState(0),d=Object(o.a)(l,2),h=d[0],p=d[1],m=a.a.useState(window.innerHeight),y=Object(o.a)(m,2),b=y[0],v=y[1],g=a.a.useState(new Map),k=Object(o.a)(g,2),_=k[0],w=k[1],x=a.a.useCallback((function(e,t){w((function(n){var r=new Map(n);return r.set(e.key,t),r}))}),[]),j=new Set(t.map((function(e){return e.key}))),E=[];_.forEach((function(e,t){j.has(t)||E.push(t)})),E.length>0&&w((function(e){var t=new Map(e);return E.forEach((function(n){e.has(n)&&t.delete(n)})),t}));var O=function(){i.current&&p(i.current.scrollTop),v(window.innerHeight)};a.a.useEffect((function(){return i.current&&(i.current.onscroll=O),window.addEventListener("resize",O),function(){window.removeEventListener("resize",O)}}));var C,S=[],D=0,A=0,I=0,M=Object(f.a)(t);try{for(M.s();!(C=M.n()).done;){var L=C.value,N=r;_.has(L.key)&&(N=_.get(L.key)),D+N<h-window.innerHeight?(L.focused&&i.current&&(i.current.scrollTop=D),A+=N):D<h+2*b?S.push(a.a.createElement(ut,Object.assign({key:L.key,onHeightChanged:x,entry:L,ItemComponent:s,scrollableContainerRef:i},u))):(L.focused&&i.current&&(i.current.scrollTop=D),I+=N),D+=N}}catch(R){M.e(R)}finally{M.f()}return 0!==A&&S.unshift(a.a.createElement(c,{height:A,key:"placeholderTop"})),0!==I&&S.push(a.a.createElement(c,{height:I,key:"placeholderBottom"})),S}var dt=n(216);function ht(e){var t=e.height,n=Object(De.a)(e,["height"]);return a.a.createElement("tr",n,a.a.createElement("td",{colSpan:"2"},a.a.createElement("div",{style:{height:t}})))}var pt=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(v.a)(this,n);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).state={entries:[]},e._onEntriesChanged=function(t,n,r){var a=r.canRedo,i=r.canUndo;if(t.length>0){for(var s=function(e){this.key=this.text=Re()(e).calendar({sameDay:"[Today], MMM Do, ddd",lastDay:"[Yesterday] , MMM Do, ddd",lastWeek:"MMM Do YYYY, ddd",sameElse:"MMM Do YYYY, ddd"})},o=(t=Object(q.a)(t))[t.length-1].creationTime,c=t.length-2;c>=0;c--){var u=t[c].creationTime;null!=o?null==u||u.getTime()<o.getTime()||null!=u&&u.getYear()===o.getYear()&&u.getMonth()===o.getMonth()&&u.getDay()===o.getDay()||(t.splice(c+1,0,new s(o)),o=u):o=u}null!=o&&t.splice(0,0,new s(o))}e.setState({entries:t,settings:n,canRedo:a,canUndo:i})},e._tableRef=a.a.createRef(),e._scrollableContainerRef=a.a.createRef(),e._columnResizer=null,e._resizeObserver=null,e}return Object(g.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.model.subscribe(this._onEntriesChanged),this._columnResizer=new rt.a(this._tableRef.current,{liveDrag:!0,minWidth:100,gripInnerHtml:"<div class='".concat(this.props.classes.grip,"'></div>"),onResize:function(e){window.dispatchEvent(new Event("resize"))}}),window.removeEventListener("resize",this._columnResizer.onResize),this._resizeObserver=new ResizeObserver(it.a.throttle((function(){e._columnResizer.onResize()}),200)),this._resizeObserver.observe(this._tableRef.current)}},{key:"componentDidUpdate",value:function(e){this.props.model!==e.model&&(e.model.unsubscribe(this._onEntriesChanged),this.props.model.subscribe(this._onEntriesChanged))}},{key:"componentWillUnmount",value:function(){this.props.model.unsubscribe(this._onEntriesChanged),this._columnResizer.destroy(),this._resizeObserver.unobserve(this._tableRef.current)}},{key:"render",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(Q.a,{className:this.props.classes.buttonsContainer,container:!0,justify:"space-between",spacing:0},a.a.createElement(Q.a,{item:!0,xs:1,sm:2},!this.props.appBarShown&&a.a.createElement(te.a,{size:"small",onClick:this.props.onShowAppBar},a.a.createElement(dt.a,{color:"primary"}))),a.a.createElement(Q.a,{className:this.props.classes.buttons,item:!0,xs:6,sm:3},a.a.createElement(ne.a,{size:"small",onClick:function(){e.props.model.addNewItemThrottled()}},"Add new item")),a.a.createElement(Q.a,{className:this.props.classes.buttons,item:!0,xs:5,sm:2},a.a.createElement(ne.a,{fullWidth:!0,size:"small",fontSize:"small",onClick:this.props.model.undo,disabled:!this.state.canUndo},"Undo"),a.a.createElement(ne.a,{fullWidth:!0,size:"small",fontSize:"small",disabled:!this.state.canRedo,onClick:this.props.model.redo},"Redo"))),a.a.createElement("div",{ref:this._scrollableContainerRef,className:this.props.classes.container,tabIndex:0},a.a.createElement("table",{cellPadding:0,cellSpacing:0,className:this.props.classes.entriesTable,ref:this._tableRef},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null),a.a.createElement("th",null))),a.a.createElement("tbody",null,a.a.createElement(lt,{entries:this.state.entries,ItemComponent:tt,PlaceholderComponent:ht,scrollableContainerRef:this._scrollableContainerRef,onUpdate:this.props.model.onUpdate,onFocus:this.props.onFocus,settings:this.state.settings})))))}}]),n}(a.a.PureComponent),ft=Object(st.a)((function(e){return{container:{overflow:"auto",flex:1,willChange:"transform"},grip:{"&:hover":{backgroundColor:"#00F8",transitionDuration:"0s"},width:8,zIndex:10,position:"absolute",height:"100%",backgroundColor:"#0000",cursor:"col-resize",transitionProperty:"background-color",transitionDuration:"1s"},entriesTable:Object(W.a)({width:"100%",borderSpacing:0,"& th":{backgroundColor:e.palette.background.paper,zIndex:3,top:0,position:"sticky",borderSpacing:0,borderBottom:"1px solid lightGray"},"& td":{padding:2,verticalAlign:"top",borderLeft:"5px solid #0000",overflow:"inherit !important"},"& td:nth-child(odd)":{borderRight:"5px solid #0000",borderLeft:"20px solid #0000"}},e.breakpoints.down("xs"),{"& thead":{display:"none"},"& tbody tr":{display:"grid",padding:5,borderRadius:4,border:"1px solid #000"},"& td:nth-child(odd)":{borderRight:0,borderLeft:0},"& tbody td":{display:"block",borderLeft:0}}),buttonsContainer:{backgroundColor:e.palette.background.paper},buttons:{display:"flex",justifyContent:"center"}}}))(pt),mt=n(227),yt=n(217);function bt(e){var t=e.model,n=Object(De.a)(e,["model"]),r=a.a.useState(E.state),i=Object(o.a)(r,2),s=i[0],c=i[1];return a.a.useEffect((function(){E.addStateListener(c)}),[]),s===w.SIGNED_IN&&t?a.a.createElement(ft,Object.assign({},n,{model:t})):s===w.SIGNED_OUT?a.a.createElement(oe,null,"Sign in to proceed..."):a.a.createElement(a.a.Fragment,null,a.a.createElement(mt.a,{invisible:!0,open:!0},a.a.createElement(yt.a,{color:"inherit"})),";",a.a.createElement(oe,null," Loading...")," ")}var vt=n(112),gt=function(){function e(){Object(v.a)(this,e)}return Object(g.a)(e,[{key:"requireFunction",value:function(e){var t=this;setTimeout((function(){if("function"!==typeof t[e])throw new Error(e+" is not implemented")}),0)}}]),e}(),kt=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).requireFunction("createKey"),e.requireFunction("delete","key"),e.requireFunction("set","key","contentString"),e.requireFunction("get","key"),e.requireFunction("getMd5","key"),e.requireFunction("getAllKeys"),e.requireFunction("getSettings"),e.requireFunction("setSettings","settings"),e.requireFunction("setDescription","key","description"),e}return n}(gt),_t=Object(_.a)("settings_key"),wt=new(function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(v.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),Object.defineProperty(Object(S.a)(e),_t,{writable:!0,value:null}),e}return Object(g.a)(n,[{key:"_getSettingsKey",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t,n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===Object(k.a)(this,_t)[_t]){e.next=2;break}return e.abrupt("return",Object(k.a)(this,_t)[_t]);case 2:return e.next=4,Rt('name = "settings.json"');case 4:if(0!==(t=e.sent).length){e.next=9;break}return e.next=8,Et("settings.json");case 8:return e.abrupt("return",e.sent);case 9:if(1!==t.length){e.next=11;break}return e.abrupt("return",t[0].id);case 11:return console.error("Invalid state. Multiple settings.json. "),n=Object(vt.a)(t),r=n[0],n.slice(1).map((function(e){return Tt(e.id)})),e.abrupt("return",r.id);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createKey",value:function(){var e=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.next=3,Et("item.json");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.next=3,Tt(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.next=3,Dt(t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.next=3,Lt(t);case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMd5",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.next=3,It(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllKeys",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.next=3,Rt('name = "item.json"');case 3:return(t=e.sent).forEach((function(e){e.description||(e.description="")})),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.t0=Lt,e.next=4,this._getSettingsKey();case 4:return e.t1=e.sent,e.next=7,(0,e.t0)(e.t1);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.t0=Dt,e.next=4,this._getSettingsKey();case 4:return e.t1=e.sent,e.t2=t,e.next=8,(0,e.t0)(e.t1,e.t2);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDescription",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xt(),e.abrupt("return",Ct(t,n));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(kt));function xt(){if(E.state!==w.SIGNED_IN)throw new Error("Incorrect state. Sign in to continue.")}function jt(e,t){var n=(new Error).stack;return new Promise((function(r,a){e(t).then((function(e){e&&(e.status<200||e.status>299)?(console.log("GAPI call returned bad status",n,e),a(e)):r(e)}),(function(e){console.log("GAPI call failed ",n,e),a(e)}))}))}function Et(e,t){return Ot.apply(this,arguments)}function Ot(){return(Ot=Object(b.a)(y.a.mark((function e(t,n){var r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jt(window.gapi.client.drive.files.create,{resource:{name:t,mimeType:n||"text/plain",parents:["appDataFolder"]},fields:"id"});case 2:return r=e.sent,e.abrupt("return",r.result.id);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(e,t){return St.apply(this,arguments)}function St(){return(St=Object(b.a)(y.a.mark((function e(t,n){var r,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.assert("string"===typeof n),"\r\n--"+(r="-------314159265358979323846")+"\r\n","\r\n--"+r+"--",a="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify({description:n})+"\r\n---------314159265358979323846--",e.next=7,jt(window.gapi.client.request,{path:"/upload/drive/v3/files/".concat(t),method:"PATCH",params:{uploadType:"multipart"},body:a,headers:{"Content-Type":'multipart/mixed; boundary="'+r+'"'}});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e,t){return At.apply(this,arguments)}function At(){return(At=Object(b.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.assert("string"===typeof n),e.next=3,jt(window.gapi.client.request,{path:"/upload/drive/v3/files/".concat(t),method:"PATCH",params:{uploadType:"media"},fields:"md5Checksum",body:n});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(e){return Mt.apply(this,arguments)}function Mt(){return(Mt=Object(b.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jt(window.gapi.client.request,{path:"/drive/v3/files/".concat(t),method:"GET",params:{fields:"md5Checksum"}});case 2:return n=e.sent,e.abrupt("return",n.result.md5Checksum);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lt(e){return Nt.apply(this,arguments)}function Nt(){return(Nt=Object(b.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jt(window.gapi.client.drive.files.get,{fileId:t,alt:"media"});case 3:return n=e.sent,e.abrupt("return",n.body);case 7:if(e.prev=7,e.t0=e.catch(0),404===e.t0.status){e.next=11;break}throw e.t0;case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function Rt(e){return Ft.apply(this,arguments)}function Ft(){return(Ft=Object(b.a)(y.a.mark((function e(t){var n,r,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=[];case 2:return e.next=4,jt(window.gapi.client.drive.files.list,{spaces:"appDataFolder",fields:"files(id, description, md5Checksum), nextPageToken",pageSize:1e3,pageToken:r,orderBy:"createdTime",q:t});case 4:a=e.sent,n=n.concat(a.result.files),r=a.result.nextPageToken;case 7:if(r){e.next=2;break}case 8:return e.abrupt("return",n);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function Tt(e){return Kt.apply(this,arguments)}function Kt(){return(Kt=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jt(window.gapi.client.drive.files.delete,{fileId:t});case 3:return e.abrupt("return",!0);case 6:if(e.prev=6,e.t0=e.catch(0),404!==e.t0.status){e.next=10;break}return e.abrupt("return",!1);case 10:throw e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}Object.seal(wt);var Bt=n(79),Pt=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(e,r){var a;return Object(v.a)(this,n),console.assert(e instanceof kt),(a=t.call(this)).addNewItemThrottled=it.a.throttle((function(){a.addNewItem()}),500),a.addNewItem=Object(b.a)(y.a.mark((function e(){var t,n,r,i=arguments;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],e.next=3,a._addNewItemMutex.acquire();case 3:if(n=e.sent,e.t0=a._tryFindVacantEntry(),e.t0){e.next=9;break}return e.next=8,a._createNewEntry();case 8:e.t0=e.sent;case 9:r=e.t0,a.onUpdate(r.clear().setFocused(!0).setInitiallyCollapsed(!0).setCreationTime(new Date(Date.now())),t),n();case 12:case"end":return e.stop()}}),e)}))),a.undo=function(){if(0!==a._historyIndex){a._historyIndex--;var e=a._history[a._historyIndex].old;e.data!==We&&(e=e.setFocused(!0),a._history[a._historyIndex].new.data===We&&(e=e.setInitiallyCollapsed(!0))),a._entries.set(e.key,e),a._sendEntryToBackend(e),a._onEntriesChanged()}},a.redo=function(){if(!(a._historyIndex>=a._history.length)){var e=a._history[a._historyIndex++],t=e.new;t.data!==We&&(t=t.setFocused(!0),e.old.data===We&&(t=t.setInitiallyCollapsed(!0))),a._entries.set(t.key,t),a._sendEntryToBackend(t),a._onEntriesChanged()}},a.sync=Object(b.a)(y.a.mark((function e(){var t,n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a._disposed){e.next=2;break}return e.abrupt("return");case 2:if(a._authClient.state===w.SIGNED_IN){e.next=7;break}return e.next=5,a._authClient.waitForStateChange();case 5:e.next=2;break;case 7:return e.next=9,a._backendMap.getAllKeys();case 9:if(t=e.sent,n=new Map,t.forEach((function(e){var r;a._entries.has(e.id)?r=a._entries.get(e.id):e.description===We?(e.outdated=!1,r=new $e(e.id).delete()):(e.outdated=!0,r=new $e(e.id,n.size<t.length-30?qe:Ge,e.description),a._descriptions.set(e.id,e.description)),e.description!==a._descriptions.get(e.id)&&(r=r.setDescription(e.description),a._descriptions.set(e.id,e.description)),n.set(e.id,r)})),r=[],null==a._settings&&r.push(a._fetchSettings()),t.reverse().forEach((function(e){e.outdated&&n.get(e.id).data!==qe&&r.push(a._fetch(e.id))})),a._entries.has(null)&&n.set(null,a._entries.get(null)),a._entries=n,0!==a._entries.size){e.next=21;break}return e.next=20,a.addNewItem(!0);case 20:return e.abrupt("return");case 21:return a._onEntriesChanged(),e.next=24,Promise.all(r);case 24:case"end":return e.stop()}}),e)}))),a.onSettingsUpdate=it.a.debounce((function(e){a._settings=e,a._onEntriesChanged(),a._backendMap.setSettings(e.stringify())}),1e3),a.onUpdate=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a._entries.has(e.key)){var n=a._entries.get(e.key);e.data!==Ge?(a._sendEntryToBackend(e),t||a._addHistoryItem(e),a._entries.set(e.key,e),a._onEntriesChanged()):n.data===qe&&(a._fetch(e.key),a._entries.set(e.key,e))}},a._disposed=!1,a._historyIndex=0,a._history=[],a._authClient=null,a._backendMap=null,a._addNewItemMutex=new Bt.a,a._entries=new Map,a._settings=null,a._descriptions=new Map,a._subscriptions=new Set,a._syncLoop=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.sync();case 2:setTimeout(a._syncLoop,15e3);case 3:case"end":return e.stop()}}),e)}))),a._onKeyPress=function(e){if(!a._ignoreKeys&&e.ctrlKey){if(90===e.keyCode)a.undo();else if(89===e.keyCode)a.redo();else{if(13!==e.keyCode)return;a.addNewItemThrottled()}e.preventDefault()}},a._fetch=function(){var e=Object(b.a)(y.a.mark((function e(t){var n,r,i,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a._backendMap.get(t);case 2:if(n=e.sent,a._entries.has(t)){e.next=6;break}return console.error("Entry for fetch doesn't exist anymore. "+t),e.abrupt("return");case 6:if(void 0!==n){e.next=11;break}return console.error("Key "+t+" is missing"),a._entries.delete(t),a._onEntriesChanged(),e.abrupt("return");case 11:if(e.prev=11,""!==n){e.next=18;break}r=new $e(t).delete(),a._addHistoryItem(r),a._entries.set(t,r),e.next=25;break;case 18:if((i=JSON.parse(n))===We||null!=i.left&&null!=i.right){e.next=21;break}throw new Error("bad format "+n);case 21:i===We&&a._descriptions.get(t)!==We&&a._backendMap.setDescription(t,We),s=new $e(t,i,a._descriptions.get(t)),a._addHistoryItem(s),a._entries.set(t,s);case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(11),console.error(e.t0.message+" "+t+" "+n),a._entries.get(t).isDataLoaded()||(a._entries.delete(t),a._descriptions.delete(t),a._backendMap.delete(t));case 31:a._onEntriesChanged();case 32:case"end":return e.stop()}}),e,null,[[11,27]])})));return function(t){return e.apply(this,arguments)}}(),a._backendMap=e,a._authClient=r,a._syncLoop(),window.addEventListener("keydown",a._onKeyPress),a}return Object(g.a)(n,[{key:"dispose",value:function(){this._disposed=!0,window.removeEventListener("keydown",this._onKeyPress),this._subscriptions=new Set}},{key:"subscribe",value:function(e){this._subscriptions.add(e),this._entries.size>0&&e(this._getFilteredEntriesArray(),this._settings)}},{key:"unsubscribe",value:function(e){this._subscriptions.delete(e)}},{key:"_tryFindVacantEntry",value:function(){var e=null;return this._entries.forEach((function(t){t.data===We?null==e&&(e=t):e=null})),e}},{key:"_createNewEntry",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._entries.has(null)){e.next=2;break}return e.abrupt("return");case 2:return this._entries.set(null,new $e(null).delete()),e.next=5,this._backendMap.createKey();case 5:if(t=e.sent,this._entries.has(null)){e.next=8;break}throw new Error("A null key should persist until the new key is created");case 8:return n=new $e(t,this._entries.get(null).data,""),this._entries.set(t,n),e.next=12,this._sendEntryToBackend(n);case 12:return this._entries.delete(null),e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setIgnoreKeys",value:function(e){this._ignoreKeys=e}},{key:"_addHistoryItem",value:function(e){if(null==e.key)throw new Error("null key shouldn't have value. There is no point to restore it.");this._entries.has(e.key)&&this._entries.get(e.key).isDataLoaded()&&(this._history=this._history.slice(0,this._historyIndex),this._history.push({old:this._entries.has(e.key)?this._entries.get(e.key):new $e(e.key).delete(),new:e}),this._historyIndex=this._history.length)}},{key:"_sendEntryToBackend",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,t.description!==this._descriptions.get(t.key)&&(n=this._backendMap.setDescription(t.key,t.description),this._descriptions.set(t.key,t.description)),r=null,t.isDataLoaded()&&(r=this._backendMap.set(t.key,JSON.stringify(t.data))),e.next=6,Promise.all([n,r]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._backendMap.getSettings();case 2:if(t=e.sent,this._serializedSettings!==t){e.next=5;break}return e.abrupt("return");case 5:this._serializedSettings=t,this._settings=new ue(t),this._onEntriesChanged();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredEntriesArray",value:function(){return Array.from(this._entries.values()).reverse().filter((function(e){return e.data!==We&&null!==e.key}))}},{key:"_onEntriesChanged",value:function(){var e=this,t=this._getFilteredEntriesArray();this._subscriptions.forEach((function(n){n(t,e._settings,{canRedo:e._history.length>e._historyIndex,canUndo:e._history.length>0&&e._historyIndex>0})}))}}]),n}(function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).requireFunction("subscribe","callback"),e.requireFunction("unsubscribe","callback"),e.requireFunction("onUpdate","entry","omitHistory"),e.requireFunction("onSettingsUpdate","settings"),e.requireFunction("setIgnoreKeys","ignoreKeys"),e.requireFunction("addNewItem"),e.requireFunction("undo"),e.requireFunction("redo"),e.requireFunction("sync"),e}return n}(gt)),zt=n(89),Ht=n.n(zt),Ut=n(113),Vt=n.n(Ut);var Gt=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(e){var r;if(Object(v.a)(this,n),(r=t.call(this))._changeKeysMutex=new Bt.a,r._innerKeys=null,r._innerBackendMap=null,r._createChunkConnector=function(e){return{setValue:function(t){r._innerBackendMap.set(e,t)},setDescription:function(t){r._innerBackendMap.setDescription(e,t)},getValue:function(){var t=Object(b.a)(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._innerBackendMap.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),delete:function(){var t=Object(b.a)(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r._innerKeys.splice(r._innerKeys.indexOf(e),1),r._chunks.delete(e),t.next=4,r._innerBackendMap.delete(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},r._chunks=new Map,r._Chunk=function(){function e(t){var n=this,r=t.connector,a=t.serializedDescriptions,i=t.md5Checksum;Object(v.a)(this,e),this._onValueSet=it.a.debounce((function(){n._serializedValues=JSON.stringify(n._values),n._connector.setValue(n._serializedValues)}),1e3),this._onDescriptionSet=it.a.debounce((function(){n._serializedDescriptions=n._descriptions.map((function(e){return null===e?"null":e})).join(","),n._connector.setDescription(n._serializedDescriptions)}),1e3),this._fetchValuesSynchronised=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==n._fetchPromise&&(n._fetchPromise=n._fetchValues()),e.next=3,n._fetchPromise;case 3:n._fetchPromise=null;case 4:case"end":return e.stop()}}),e)}))),this._fetchPromise=null,this._fetchValues=Object(b.a)(y.a.mark((function e(){var t,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._connector.getValue();case 2:if(t=e.sent,e.prev=3,r=JSON.parse(t),Array.isArray(r)){e.next=7;break}throw new Error("Bad server data. Not valid array");case 7:for(;r.length<n._descriptions.length;)r.push("");n._values=r,n._serializedValues=t,n._initialMd5Checksum=Ht()(t),n._isDirty=!1,e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),console.error("Bad response from server:"+e.t0.message+" "+t),n._shouldKeepOnFormatError?(n._values=Array(8).fill(""),n._isDirty=!0,n._serializedValues=null,n._onValueSet()):n._connector.delete();case 18:case"end":return e.stop()}}),e,null,[[3,14]])}))),this._connector=r,this._initialMd5Checksum=i,void 0===a?(this._values=Array(8).fill(""),this._descriptions=[],this._isDirty=!0):(this._serializedDescriptions=a,this._isDirty=!1,this._descriptions=a.split(",").map((function(e){return"null"===e?null:e})))}return Object(g.a)(e,[{key:"isFull",value:function(){return this._descriptions.length>=8}},{key:"listSubKeys",value:function(){for(var e=[],t=0;t<this._descriptions.length&&t<8;t++)null!=this._descriptions[t]&&e.push(t);return e}},{key:"createSubKey",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._shouldKeepOnFormatError=!0,e.prev=1,null!=this._values){e.next=5;break}return e.next=5,this._fetchValuesSynchronised();case 5:if(null!=this._values){e.next=7;break}return e.abrupt("return",null);case 7:if(!this.isFull()){e.next=9;break}throw new Error("Do not call createSubKey for full chunks");case 9:return t=this._descriptions.length,this._descriptions.push(""),this.setDescription(t,""),e.abrupt("return",t);case 13:return e.prev=13,this._shouldKeepOnFormatError=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[1,,13,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this._descriptions[t]){e.next=2;break}throw new Error("item is already deleted");case 2:if(1!==this._descriptions.filter((function(e){return null!=e})).length){e.next=7;break}return e.next=5,this._connector.delete();case 5:e.next=8;break;case 7:this.setDescription(t,null);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setValue",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this._values){e.next=3;break}return e.next=3,this._fetchValuesSynchronised();case 3:if(null!=this._values){e.next=5;break}return e.abrupt("return");case 5:this._values[t]=n,this._isDirty=!0,this._serializedValues=null,this._onValueSet();case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getValue",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._descriptions[t]){e.next=2;break}return e.abrupt("return",void 0);case 2:if(null!=this._values){e.next=5;break}return e.next=5,this._fetchValuesSynchronised();case 5:if(null!=this._values){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.abrupt("return",this._values[t]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDescription",value:function(e,t){if(e>=this._descriptions.length||null==this._descriptions[e])throw new Error("null description means subkey doesn't exist. Did you call createKey?");this._descriptions[e]=t,this._serializedDescriptions=null,this._isDirty=!0,this._onDescriptionSet()}},{key:"getDescription",value:function(e){return this._descriptions[e]}},{key:"onMetadataUpdate",value:function(e,t){return this._isDirty?(null!=this._serializedValues&&null!=this._serializedDescriptions&&Ht()(this._serializedValues)===t&&this._serializedDescriptions===e&&(this._isDirty=!1,this._initialMd5Checksum=t),{outdated:!1}):(this._serializedDescriptions!==e&&(this._serializedDescriptions=e,this._descriptions=e.split(",").map((function(e){return"null"===e?null:e}))),this._initialMd5Checksum!==t?(this._serializedValues=null,this._values=null,{outdated:!0}):{outdated:!1})}}]),e}(),r._splitOuterKey=function(e){var t=e.indexOf("-");return{prefixKey:Number(e.substring(0,t)),innerKey:e.substring(t+1)}},!e instanceof kt)throw new Error("CachingBackendMap have to accepts instance of BackendMap");return r._innerBackendMap=e,r}return Object(g.a)(n,[{key:"createKey",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t,n,r,a,i,s=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._changeKeysMutex.acquire();case 2:if(t=e.sent,e.prev=3,null!==this._innerKeys){e.next=6;break}throw new Error("You should call getAllKeys first");case 6:if(n=function(){if(0!==s._innerKeys.length)return s._innerKeys[s._innerKeys.length-1]},0!==this._innerKeys.length&&!this._chunks.get(n()).isFull()){e.next=13;break}return e.next=10,this._innerBackendMap.createKey();case 10:r=e.sent,this._innerKeys.push(r),this._chunks.set(r,new this._Chunk({connector:this._createChunkConnector(r)}));case 13:return a=n(),e.next=16,this._chunks.get(a).createSubKey();case 16:return i=e.sent,e.abrupt("return",i+"-"+a);case 18:return e.prev=18,t(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n,r,a,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._changeKeysMutex.acquire();case 2:if(n=e.sent,e.prev=3,r=this._splitOuterKey(t),a=r.prefixKey,i=r.innerKey,this._chunks.has(i)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this._chunks.get(i).delete(a);case 9:return e.prev=9,n(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[3,,9,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){var r,a,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._splitOuterKey(t),a=r.prefixKey,i=r.innerKey,this._chunks.has(i)){e.next=3;break}return e.abrupt("return");case 3:this._chunks.get(i).setValue(a,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMd5",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Don't call getMd5 on this class. Server cannot compute md5 for this item because it is multiplexed.In order to sync call |getAllKeys| and if some item has |outdated===true| call |get|.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n,r,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._splitOuterKey(t),r=n.prefixKey,a=n.innerKey,this._chunks.has(a)){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.abrupt("return",this._chunks.get(a).getValue(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllKeys",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t,n,r,a,i,s=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._changeKeysMutex.acquire();case 2:return t=e.sent,e.prev=3,e.next=6,this._innerBackendMap.getAllKeys();case 6:return n=e.sent,r=[],a=new Map,i=0,n.forEach((function(e){var t=!0,n=0===i++;if(s._chunks.has(e.id)){var o=s._chunks.get(e.id);a.set(e.id,o),t=o.onMetadataUpdate(e.description,e.md5Checksum).outdated}else a.set(e.id,new s._Chunk({connector:s._createChunkConnector(e.id),serializedDescriptions:e.description,isFirstChunk:n,md5Checksum:e.md5Checksum}));var c=a.get(e.id);c.listSubKeys().forEach((function(n){r.push({id:n+"-"+e.id,outdated:t,description:c.getDescription(n)})}))})),this._chunks=a,this._innerKeys=n.map((function(e){return e.id})),e.abrupt("return",r);case 14:return e.prev=14,t(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[3,,14,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"getSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._innerBackendMap.getSettings();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._changeKeysMutex.acquire();case 2:return n=e.sent,e.next=5,this._innerBackendMap.setSettings(t);case 5:n();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDescription",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){var r,a,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._splitOuterKey(t),a=r.prefixKey,i=r.innerKey,this._chunks.has(i)){e.next=3;break}return e.abrupt("return");case 3:this._chunks.get(i).setDescription(a,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(kt),qt=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(e){var r;if(Object(v.a)(this,n),(r=t.call(this))._innerBackendMap=null,!e instanceof kt)throw new Error("CachingBackendMap have to accepts instance of BackendMap");return r._innerBackendMap=e,r}return Object(g.a)(n,[{key:"_exponentialRetry",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=1;case 1:if(!(n<10)){e.next=16;break}return e.prev=2,e.next=5,t();case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),r=1*Math.pow(3,n++),console.error("Failed running ".concat(t.name," : ").concat(e.t0.message,". Will try again after ").concat(r," seconds.")),e.next=14,this._sleep(1e3*r);case 14:e.next=1;break;case 16:console.error("finish retry attempts");case 17:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createKey",value:function(){var e=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.createKey.bind(this._innerBackendMap));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.delete.bind(this._innerBackendMap,t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.set.bind(this._innerBackendMap,t,n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.get.bind(this._innerBackendMap,t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMd5",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.getMd5.bind(this._innerBackendMap,t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllKeys",value:function(){var e=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.getAllKeys.bind(this._innerBackendMap));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.getSettings.bind(this._innerBackendMap));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.setSettings.bind(this._innerBackendMap,t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDescription",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._exponentialRetry(this._innerBackendMap.setDescription.bind(this._innerBackendMap,t,n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_sleep",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}}]),n}(kt),Wt=function(e){Object(D.a)(n,e);var t=Object(A.a)(n);function n(e){var r;if(Object(v.a)(this,n),(r=t.call(this))._innerBackendMap=null,!e instanceof kt)throw new Error("CachingBackendMap have to accepts instance of BackendMap");return r._innerBackendMap=e,r._limiter=new Vt.a({maxConcurrent:5,minTime:50}),r}return Object(g.a)(n,[{key:"createKey",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return t._innerBackendMap.createKey()}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return n._innerBackendMap.delete(t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){var r=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return r._innerBackendMap.set(t,n)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return n._innerBackendMap.get(t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMd5",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return n._innerBackendMap.getMd5(t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAllKeys",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return t._innerBackendMap.getAllKeys()}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(){var t=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return t._innerBackendMap.getSettings()}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSettings",value:function(){var e=Object(b.a)(y.a.mark((function e(t){var n=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return n._innerBackendMap.setSettings(t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDescription",value:function(){var e=Object(b.a)(y.a.mark((function e(t,n){var r=this;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._limiter.schedule((function(){return r._innerBackendMap.setDescription(t,n)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(kt);var Jt=function(){var e=Object(c.a)("(prefers-color-scheme: dark)"),t=a.a.useMemo((function(){return Object(u.a)({palette:{type:e?"dark":"light",primary:{main:e?h.a[900]:p.a[800]},background:{default:e?"#303030":h.a[50]}}})}),[e]),n=a.a.useState(!0),r=Object(o.a)(n,2),i=r[0],s=r[1],f=a.a.useCallback((function(e){window.innerHeight<700&&s(!1)}),[]),m=a.a.useCallback((function(e){s(!0)}),[]),y=a.a.useState(null),b=Object(o.a)(y,2),v=b[0],g=b[1];return a.a.useEffect((function(){E.addStateListener((function(e){g(e===w.SIGNED_IN?new Pt(new Gt(new Wt(new qt(wt))),E):function(e){return e&&e.dispose(),null})}))}),[]),a.a.createElement(l.a,{theme:t},a.a.createElement(d.a,null),a.a.createElement(Se,{shown:i,model:v}),a.a.createElement(bt,{onFocus:f,appBarShown:i,onShowAppBar:m,model:v}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Jt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[125,1,2]]]);
//# sourceMappingURL=main.30c21fe1.chunk.js.map